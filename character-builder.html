<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>‚öîÔ∏è RPG Character Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; overflow: hidden; }
  body {
    font-family: 'Silkscreen', monospace;
    background: linear-gradient(160deg, #0c0c1d 0%, #1a1a35 40%, #0d2137 100%);
    color: #ccc;
    touch-action: manipulation;
  }
  @keyframes bob { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-4px)} }
  @keyframes shimmer { 0%,100%{box-shadow:0 0 12px rgba(100,220,200,0.2)} 50%{box-shadow:0 0 24px rgba(100,220,200,0.45)} }

  #app { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }

  /* Top bar */
  .topbar { display:flex; align-items:center; gap:8px; padding:6px 10px; border-bottom:1px solid #1a3050; flex-shrink:0; flex-wrap:wrap; }
  .topbar .title { color:#64dcc8; font-size:clamp(11px,2.5vw,14px); letter-spacing:2px; text-shadow:0 0 20px rgba(100,220,200,0.4); white-space:nowrap; }
  .topbar input { font-family:'Silkscreen',monospace; font-size:11px; padding:4px 8px; background:#111a30; color:#64dcc8; border:1px solid #1a3050; border-radius:6px; outline:none; width:100%; max-width:180px; }
  .topbar input::placeholder { color:#445566; }
  .topbar .btns { display:flex; gap:6px; }
  .btn { font-family:'Silkscreen',monospace; font-size:10px; padding:5px 10px; color:#fff; border:none; border-radius:7px; cursor:pointer; transition:all .1s; }
  .btn:active { transform:scale(0.95); }
  .btn-rand { background:#d35f5f; box-shadow:0 3px 10px #d35f5f44; }
  .btn-save { background:#2980b9; box-shadow:0 3px 10px #2980b944; }

  /* Main split */
  .main { flex:1; display:flex; overflow:hidden; min-height:0; }

  /* Left preview */
  .preview { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:10px; flex-shrink:0; }
  .scene { background:linear-gradient(180deg,#2a1a40 0%,#1a3050 28%,#4a8848 62%,#3a6838 100%); border-radius:10px; padding:14px; animation:shimmer 4s ease-in-out infinite; display:flex; justify-content:center; align-items:center; width:min(90%,320px); aspect-ratio:1; }
  .scene canvas { image-rendering:pixelated; width:100%; height:100%; animation:bob 3s ease-in-out infinite; }
  .nameplate { margin-top:8px; padding:3px 14px; background:rgba(100,220,200,0.08); border:1px solid #1a3858; border-radius:6px; color:#64dcc8; font-size:clamp(10px,2vw,13px); text-align:center; letter-spacing:1px; max-width:90%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  /* Divider */
  .divider { width:8px; cursor:col-resize; background:#1a3050; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:background .15s; touch-action:none; }
  .divider:hover, .divider:active { background:#2a4060; }
  .divider::after { content:''; display:block; width:2px; height:32px; border-radius:1px; background:#3a5a7a; box-shadow:4px 0 0 #3a5a7a; }

  /* Right controls */
  .controls { flex:1; display:flex; flex-direction:column; min-width:0; overflow:hidden; }
  .tabs { display:flex; border-bottom:2px solid #1a3050; flex-shrink:0; }
  .tab { font-family:'Silkscreen',monospace; font-size:9px; padding:6px 4px; flex:1; background:#111a30; color:#667788; border:none; border-bottom:3px solid transparent; cursor:pointer; transition:all .1s; white-space:nowrap; }
  .tab:hover { background:#1e2d50; }
  .tab.on { background:#0d2137; border-bottom-color:#64dcc8; color:#64dcc8; }
  .tab .icon { font-size:13px; display:block; }
  .options { flex:1; overflow-y:auto; padding:8px 12px; }
  .sec { margin-bottom:10px; }
  .sec-label { color:#64dcc8; font-size:9px; margin-bottom:5px; text-transform:uppercase; letter-spacing:1.5px; }
  .swatches { display:flex; gap:3px; flex-wrap:wrap; align-items:center; }
  .sw { width:22px; height:22px; border-radius:4px; border:2px solid transparent; cursor:pointer; transition:all .1s; flex-shrink:0; display:flex; align-items:center; justify-content:center; }
  .sw:hover { transform:scale(1.2); z-index:1; }
  .sw.on { border-color:#64dcc8; box-shadow:0 0 8px rgba(100,220,200,0.5); }
  .sw-none { background:#111a30; color:#556; font-size:11px; }
  .textbtns { display:flex; gap:4px; flex-wrap:wrap; }
  .tx { font-family:'Silkscreen',monospace; font-size:9px; padding:4px 8px; background:#111a30; color:#556677; border:1px solid #1a3050; border-radius:5px; cursor:pointer; transition:all .08s; }
  .tx:hover { transform:translateY(-1px); filter:brightness(1.3); }
  .tx.on { background:#1a3858; color:#64dcc8; border-color:#2a5878; outline:2px solid #64dcc8; outline-offset:1px; }

  /* Modal */
  .modal-bg { position:fixed; inset:0; background:rgba(0,0,0,0.85); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000; }
  .modal { background:#111a30; border:2px solid #64dcc8; border-radius:14px; padding:20px; display:flex; flex-direction:column; align-items:center; gap:12px; max-width:90vw; }
  .modal .modal-title { color:#64dcc8; font-size:16px; }
  .modal img { image-rendering:pixelated; width:256px; height:auto; max-height:320px; border:2px solid #1a3050; border-radius:8px; }
  .modal .hint { color:#8899aa; font-size:9px; text-align:center; line-height:1.6; }
  .modal .close-btn { font-family:'Silkscreen',monospace; font-size:11px; padding:6px 18px; background:#d35f5f; color:#fff; border:none; border-radius:8px; cursor:pointer; }

  /* Scrollbar */
  ::-webkit-scrollbar { width:6px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:#64dcc8; border-radius:3px; }
</style>
</head>
<body>
<div id="app">
  <div class="topbar">
    <span class="title">‚öîÔ∏è Character Builder</span>
    <div style="flex:1;min-width:80px"><input id="nameInput" value="Hero" placeholder="Name..."></div>
    <div class="btns">
      <button class="btn btn-rand" id="btnRandom">üé≤ Random</button>
      <button class="btn btn-save" id="btnSave">üíæ Save</button>
    </div>
  </div>

  <div class="main" id="mainArea">
    <div class="preview" id="previewPanel">
      <div class="scene">
        <canvas id="charCanvas" width="32" height="32"></canvas>
      </div>
      <div class="nameplate" id="nameplate">Hero</div>
    </div>
    <div class="divider" id="divider"></div>
    <div class="controls">
      <div class="tabs" id="tabBar"></div>
      <div class="options" id="optionsPanel"></div>
    </div>
  </div>
</div>

<!-- Export modal (hidden) -->
<div class="modal-bg" id="modal" style="display:none">
  <div class="modal">
    <div class="modal-title" id="modalTitle">Your Character</div>
    <img id="modalImg" src="" alt="Character">
    <div class="hint">Long-press the image and<br>choose "Save Image"</div>
    <button class="close-btn" id="modalClose">Close</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PIXEL ART CHARACTER BUILDER - Standalone HTML
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const W = 32, H = 32;

// ‚îÄ‚îÄ‚îÄ Palettes ‚îÄ‚îÄ‚îÄ
const SKIN = {
  Light:{base:"#f5c8a0",shade:"#d4a070",hi:"#ffe0c0"},
  Tan:{base:"#d4a060",shade:"#b08040",hi:"#e8c080"},
  Brown:{base:"#8b5e3c",shade:"#6b3e1c",hi:"#a07850"},
  Dark:{base:"#5c3a1e",shade:"#3c2a10",hi:"#7a5030"},
  Olive:{base:"#b8a878",shade:"#908060",hi:"#d0c090"},
  Pale:{base:"#ffe8d8",shade:"#e0c0a8",hi:"#fff0e8"},
  Zombie:{base:"#7a9a50",shade:"#5a7a30",hi:"#90b060"},
};
const HAIR_COLORS = {
  Brown:{base:"#6b3a1a",shade:"#4a2510",hi:"#8a5030"},
  Black:{base:"#1a1a2e",shade:"#0a0a18",hi:"#2e2e48"},
  Blonde:{base:"#e0c060",shade:"#c0a040",hi:"#f0d880"},
  Red:{base:"#b03020",shade:"#802010",hi:"#d04830"},
  White:{base:"#d8d8e0",shade:"#b0b0c0",hi:"#f0f0f8"},
  Blue:{base:"#3060c0",shade:"#2040a0",hi:"#4878e0"},
  Green:{base:"#308030",shade:"#206020",hi:"#48a848"},
  Pink:{base:"#e06898",shade:"#c04878",hi:"#f088b0"},
  Purple:{base:"#7030a0",shade:"#502080",hi:"#9048c0"},
};
const CLOTH = {
  Red:{base:"#c03030",shade:"#901818",hi:"#e04848"},
  Blue:{base:"#3050b0",shade:"#203888",hi:"#4868d0"},
  Green:{base:"#308838",shade:"#206820",hi:"#48a850"},
  Teal:{base:"#308888",shade:"#206868",hi:"#48a8a8"},
  Purple:{base:"#703098",shade:"#502078",hi:"#9048b8"},
  White:{base:"#d8d8e0",shade:"#b0b0c0",hi:"#f0f0f8"},
  Black:{base:"#2a2a38",shade:"#18182a",hi:"#404058"},
  Brown:{base:"#785030",shade:"#583818",hi:"#987048"},
  Orange:{base:"#d07020",shade:"#a05010",hi:"#e89038"},
  Yellow:{base:"#d0b020",shade:"#a89018",hi:"#e8c838"},
  Maroon:{base:"#702030",shade:"#501018",hi:"#903848"},
  Navy:{base:"#202860",shade:"#101848",hi:"#384078"},
  Gray:{base:"#787888",shade:"#585868",hi:"#9898a8"},
  Pink:{base:"#e06888",shade:"#c04868",hi:"#f888a8"},
};
const EYE = {Blue:"#4488dd",Brown:"#885522",Green:"#44aa44",Gray:"#888899",Red:"#cc3333",Purple:"#8844cc",Gold:"#ccaa22",Black:"#222233"};
const METAL = {
  Steel:{base:"#a0a8b8",shade:"#707888",hi:"#c8d0e0"},
  Gold:{base:"#d0a830",shade:"#a08018",hi:"#e8c848"},
  Bronze:{base:"#b08030",shade:"#886018",hi:"#c89848"},
  Iron:{base:"#686878",shade:"#484858",hi:"#888898"},
};

// ‚îÄ‚îÄ‚îÄ Pixel helpers ‚îÄ‚îÄ‚îÄ
function px(c,x,y,color){c.fillStyle=color;c.fillRect(x,y,1,1);}
function rc(c,x,y,w,h,color){c.fillStyle=color;c.fillRect(x,y,w,h);}

// ‚îÄ‚îÄ‚îÄ Drawing functions ‚îÄ‚îÄ‚îÄ
function drawBody(c,skin){
  const s=SKIN[skin];
  rc(c,12,2,8,1,s.base);rc(c,11,3,10,8,s.base);rc(c,12,11,8,1,s.base);
  rc(c,11,3,1,8,s.shade);rc(c,20,3,1,8,s.shade);rc(c,12,10,8,1,s.shade);rc(c,12,11,8,1,s.shade);
  rc(c,13,3,6,1,s.hi);px(c,12,3,s.hi);
  rc(c,14,12,4,1,s.base);rc(c,14,12,1,1,s.shade);
  rc(c,11,13,10,8,s.base);rc(c,11,13,1,8,s.shade);rc(c,20,13,1,8,s.shade);rc(c,11,20,10,1,s.shade);
  rc(c,8,13,3,8,s.base);rc(c,21,13,3,8,s.base);
  rc(c,8,13,1,8,s.shade);rc(c,23,13,1,8,s.shade);rc(c,8,20,3,1,s.shade);rc(c,21,20,3,1,s.shade);
  rc(c,8,21,3,2,s.base);rc(c,21,21,3,2,s.base);rc(c,8,22,3,1,s.shade);rc(c,21,22,3,1,s.shade);
}
function drawEyes(c,col){
  const v=EYE[col];
  rc(c,13,6,3,2,"#e8e8f0");rc(c,17,6,3,2,"#e8e8f0");
  rc(c,14,6,2,2,v);rc(c,18,6,2,2,v);
  px(c,14,6,"#fff");px(c,18,6,"#fff");
  px(c,13,6,"#000");px(c,15,6,"#000");px(c,17,6,"#000");px(c,19,6,"#000");
}
function drawMouth(c,skin){
  const s=SKIN[skin];px(c,14,9,s.shade);rc(c,15,9,2,1,"#c06060");px(c,17,9,s.shade);
}
function drawHair(c,style,color){
  if(style==="None")return;const h=HAIR_COLORS[color];
  if(style==="Short"){
    rc(c,11,1,10,3,h.base);rc(c,10,2,1,4,h.base);rc(c,21,2,1,4,h.base);
    rc(c,11,1,10,1,h.hi);rc(c,10,2,1,2,h.shade);rc(c,21,2,1,2,h.shade);
  }else if(style==="Messy"){
    rc(c,10,0,12,4,h.base);rc(c,10,2,1,5,h.base);rc(c,21,2,1,5,h.base);
    px(c,9,1,h.base);px(c,22,1,h.base);px(c,9,3,h.base);px(c,22,4,h.base);
    rc(c,10,0,12,1,h.hi);rc(c,10,4,1,3,h.shade);rc(c,21,4,1,3,h.shade);
  }else if(style==="Long"){
    rc(c,10,0,12,4,h.base);rc(c,10,2,2,16,h.base);rc(c,20,2,2,16,h.base);
    rc(c,10,0,12,1,h.hi);rc(c,10,4,1,14,h.shade);rc(c,21,4,1,14,h.shade);
  }else if(style==="Mohawk"){
    rc(c,14,-1,4,5,h.base);rc(c,13,2,6,2,h.base);
    rc(c,14,-1,4,1,h.hi);rc(c,15,-1,2,1,h.shade);
  }else if(style==="Ponytail"){
    rc(c,11,1,10,3,h.base);rc(c,10,2,1,4,h.base);rc(c,21,2,1,4,h.base);
    rc(c,20,6,2,10,h.base);rc(c,21,6,1,10,h.shade);rc(c,11,1,10,1,h.hi);
  }else if(style==="Curly"){
    rc(c,10,0,12,5,h.base);rc(c,9,2,1,5,h.base);rc(c,22,2,1,5,h.base);
    px(c,10,6,h.base);px(c,21,6,h.base);
    rc(c,10,0,12,1,h.hi);px(c,11,1,h.hi);px(c,13,1,h.hi);px(c,17,1,h.hi);px(c,19,1,h.hi);
    rc(c,9,5,1,2,h.shade);rc(c,22,5,1,2,h.shade);
  }else if(style==="Spiky"){
    rc(c,11,1,10,3,h.base);rc(c,10,2,1,4,h.base);rc(c,21,2,1,4,h.base);
    px(c,11,0,h.base);px(c,13,-1,h.base);px(c,14,0,h.base);
    px(c,16,-1,h.base);px(c,17,0,h.base);px(c,19,-1,h.base);px(c,20,0,h.base);
    px(c,13,-1,h.hi);px(c,16,-1,h.hi);px(c,19,-1,h.hi);
  }
}
function drawShirt(c,color){
  if(color==="None")return;const v=CLOTH[color];
  rc(c,11,13,10,8,v.base);rc(c,8,13,3,6,v.base);rc(c,21,13,3,6,v.base);
  rc(c,11,13,1,8,v.shade);rc(c,20,13,1,8,v.shade);rc(c,8,13,1,6,v.shade);rc(c,23,13,1,6,v.shade);
  rc(c,11,20,10,1,v.shade);rc(c,14,13,4,1,v.hi);rc(c,14,12,4,1,v.shade);
  px(c,15,13,v.shade);px(c,16,13,v.shade);
}
function drawPants(c,color){
  if(color==="None")return;const v=CLOTH[color];
  rc(c,11,21,5,7,v.base);rc(c,16,21,5,7,v.base);
  px(c,15,25,v.shade);px(c,16,25,v.shade);
  rc(c,11,21,1,7,v.shade);rc(c,20,21,1,7,v.shade);
  rc(c,11,27,5,1,v.shade);rc(c,16,27,5,1,v.shade);rc(c,11,21,10,1,v.shade);
  rc(c,13,22,2,1,v.hi);rc(c,17,22,2,1,v.hi);
}
function drawShoes(c,color){
  if(color==="None")return;const v=CLOTH[color];
  rc(c,10,28,6,2,v.base);rc(c,10,29,6,1,v.shade);px(c,10,28,v.shade);rc(c,11,28,4,1,v.hi);
  rc(c,16,28,6,2,v.base);rc(c,16,29,6,1,v.shade);px(c,21,28,v.shade);rc(c,17,28,4,1,v.hi);
}
function drawArmor(c,metal){
  if(metal==="None")return;const m=METAL[metal];
  rc(c,12,14,8,6,m.base);rc(c,12,14,1,6,m.shade);rc(c,19,14,1,6,m.shade);rc(c,12,19,8,1,m.shade);rc(c,14,14,4,1,m.hi);
  rc(c,8,13,3,2,m.base);rc(c,21,13,3,2,m.base);rc(c,8,13,3,1,m.hi);rc(c,21,13,3,1,m.hi);
  rc(c,8,14,1,1,m.shade);rc(c,23,14,1,1,m.shade);
  px(c,15,15,m.shade);px(c,16,15,m.shade);px(c,15,17,m.shade);px(c,16,17,m.shade);
}
function drawHelmet(c,metal){
  if(metal==="None")return;const m=METAL[metal];
  rc(c,11,1,10,4,m.base);rc(c,10,3,1,4,m.base);rc(c,21,3,1,4,m.base);
  rc(c,15,5,2,3,m.base);rc(c,10,5,1,2,m.shade);rc(c,21,5,1,2,m.shade);
  rc(c,11,1,10,1,m.hi);rc(c,15,5,2,1,m.hi);
}
function drawCrown(c,metal){
  if(metal==="None")return;const m=METAL[metal];
  rc(c,11,1,10,2,m.base);
  px(c,11,0,m.base);px(c,13,0,m.base);px(c,15,-1,m.base);px(c,16,-1,m.base);px(c,18,0,m.base);px(c,20,0,m.base);
  px(c,13,1,"#cc2222");px(c,15,0,"#2255cc");px(c,16,0,"#2255cc");px(c,18,1,"#22cc22");
  rc(c,12,1,8,1,m.hi);
}
function drawHood(c,color){
  if(color==="None")return;const v=CLOTH[color];
  rc(c,10,0,12,5,v.base);rc(c,9,3,1,6,v.base);rc(c,22,3,1,6,v.base);
  rc(c,10,0,12,1,v.hi);rc(c,9,7,1,2,v.shade);rc(c,22,7,1,2,v.shade);
  rc(c,10,5,1,6,v.shade);rc(c,21,5,1,6,v.shade);
}
function drawCape(c,color){
  if(color==="None")return;const v=CLOTH[color];
  rc(c,7,13,2,14,v.base);rc(c,23,13,2,14,v.base);rc(c,9,18,2,9,v.base);rc(c,21,18,2,9,v.base);
  rc(c,7,13,1,14,v.shade);rc(c,24,13,1,14,v.shade);rc(c,7,26,4,1,v.shade);rc(c,21,26,4,1,v.shade);
  rc(c,8,13,1,3,v.hi);rc(c,23,13,1,3,v.hi);
}
function drawSword(c){
  rc(c,6,5,1,12,"#c0c8d8");rc(c,7,5,1,12,"#a0a8b8");px(c,6,4,"#d0d8e8");px(c,7,4,"#d0d8e8");px(c,6,3,"#e0e8f0");
  rc(c,4,17,5,1,"#c8a030");px(c,4,17,"#a08020");rc(c,6,18,2,3,"#6b3a1a");px(c,6,19,"#8a5030");rc(c,6,21,2,1,"#c8a030");
}
function drawAxe(c){
  rc(c,6,8,1,14,"#6b3a1a");px(c,6,10,"#8a5030");px(c,6,14,"#8a5030");
  rc(c,3,6,4,4,"#a0a8b8");px(c,2,7,"#a0a8b8");px(c,2,8,"#a0a8b8");
  rc(c,3,6,4,1,"#c0c8d8");rc(c,3,9,4,1,"#707888");px(c,2,7,"#c0c8d8");
}
function drawStaff(c){
  rc(c,6,2,1,20,"#6b3a1a");px(c,6,5,"#8a5030");px(c,6,10,"#8a5030");px(c,6,15,"#8a5030");
  rc(c,5,0,3,3,"#6688dd");px(c,6,0,"#88aaff");px(c,5,2,"#4466aa");
}
function drawBow(c){
  const b="#6b3a1a",s="#999";
  [6,7].forEach(y=>px(c,3,y,b));px(c,4,8,b);[9,10,11,12,13].forEach(y=>px(c,5,y,b));
  px(c,4,14,b);[15,16].forEach(y=>px(c,3,y,b));
  [7,8,9,10,11,12,13,14,15].forEach(y=>px(c,6,y,s));
}
function drawShield(c,metal){
  if(metal==="None")return;const m=METAL[metal];
  rc(c,23,14,5,7,m.base);rc(c,24,13,3,1,m.base);rc(c,24,21,3,1,m.base);px(c,25,22,m.base);
  rc(c,27,14,1,7,m.shade);rc(c,24,21,3,1,m.shade);
  rc(c,24,14,1,3,m.hi);rc(c,24,13,3,1,m.hi);
  rc(c,25,15,1,4,m.shade);rc(c,24,17,3,1,m.shade);
}

function drawCharacter(canvas,o){
  const c=canvas.getContext("2d");
  c.imageSmoothingEnabled=false;
  c.clearRect(0,0,W,H);
  if(o.cape!=="None")drawCape(c,o.cape);
  drawBody(c,o.skin);drawEyes(c,o.eyes);drawMouth(c,o.skin);
  if(o.pants!=="None")drawPants(c,o.pants);
  if(o.shoes!=="None")drawShoes(c,o.shoes);
  if(o.shirt!=="None")drawShirt(c,o.shirt);
  if(o.armor!=="None")drawArmor(c,o.armor);
  if(o.headgear==="Helmet")drawHelmet(c,o.headMetal);
  else if(o.headgear==="Crown")drawCrown(c,o.headMetal);
  else if(o.headgear==="Hood")drawHood(c,o.hoodColor);
  else drawHair(c,o.hairStyle,o.hairColor);
  if(o.weapon==="Sword")drawSword(c);
  else if(o.weapon==="Axe")drawAxe(c);
  else if(o.weapon==="Staff")drawStaff(c);
  else if(o.weapon==="Bow")drawBow(c);
  if(o.shield!=="None")drawShield(c,o.shield);
}

// ‚îÄ‚îÄ‚îÄ Config ‚îÄ‚îÄ‚îÄ
const HAIR_STYLES=["None","Short","Messy","Long","Mohawk","Ponytail","Curly","Spiky"];
const WEAPONS=["None","Sword","Axe","Staff","Bow"];
const HEADGEARS=["None","Helmet","Crown","Hood"];

const TABS=[
  {id:"body",label:"Body",icon:"üë§",sections:[
    {key:"skin",label:"Skin",type:"swatch",palette:SKIN},
    {key:"eyes",label:"Eyes",type:"swatch",palette:EYE,isFlat:true},
  ]},
  {id:"hair",label:"Hair",icon:"üíá",sections:[
    {key:"hairStyle",label:"Style",type:"text",options:HAIR_STYLES},
    {key:"hairColor",label:"Color",type:"swatch",palette:HAIR_COLORS},
  ]},
  {id:"clothes",label:"Outfit",icon:"üëï",sections:[
    {key:"shirt",label:"Shirt",type:"swatch",palette:CLOTH,allowNone:true},
    {key:"pants",label:"Pants",type:"swatch",palette:CLOTH,allowNone:true},
    {key:"shoes",label:"Shoes",type:"swatch",palette:CLOTH,allowNone:true},
  ]},
  {id:"armor",label:"Armor",icon:"üõ°Ô∏è",sections:[
    {key:"armor",label:"Plate",type:"swatch",palette:METAL,allowNone:true},
    {key:"headgear",label:"Head",type:"text",options:HEADGEARS},
    {key:"headMetal",label:"Metal",type:"swatch",palette:METAL,showIf:o=>o.headgear==="Helmet"||o.headgear==="Crown"},
    {key:"hoodColor",label:"Hood",type:"swatch",palette:CLOTH,showIf:o=>o.headgear==="Hood"},
  ]},
  {id:"weapons",label:"Arms",icon:"‚öîÔ∏è",sections:[
    {key:"weapon",label:"Weapon",type:"text",options:WEAPONS},
    {key:"shield",label:"Shield",type:"swatch",palette:METAL,allowNone:true},
    {key:"cape",label:"Cape",type:"swatch",palette:CLOTH,allowNone:true},
  ]},
];

// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ
let opts = {
  skin:"Light",eyes:"Blue",hairStyle:"Short",hairColor:"Brown",
  shirt:"Teal",pants:"Blue",shoes:"Brown",
  armor:"None",headgear:"None",headMetal:"Steel",hoodColor:"Black",
  weapon:"None",shield:"None",cape:"None",
};
let currentTab = "body";
let leftPct = 45;
let isDragging = false;

// ‚îÄ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ‚îÄ
const canvas = document.getElementById("charCanvas");
const nameInput = document.getElementById("nameInput");
const nameplate = document.getElementById("nameplate");
const tabBar = document.getElementById("tabBar");
const optionsPanel = document.getElementById("optionsPanel");
const previewPanel = document.getElementById("previewPanel");
const mainArea = document.getElementById("mainArea");
const divider = document.getElementById("divider");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");
const modalTitle = document.getElementById("modalTitle");
const modalClose = document.getElementById("modalClose");
const btnRandom = document.getElementById("btnRandom");
const btnSave = document.getElementById("btnSave");

// ‚îÄ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ
function render() {
  drawCharacter(canvas, opts);
  nameplate.textContent = nameInput.value || "???";
  previewPanel.style.width = leftPct + "%";
  renderTabs();
  renderOptions();
}

function renderTabs() {
  tabBar.innerHTML = "";
  TABS.forEach(t => {
    const btn = document.createElement("button");
    btn.className = "tab" + (currentTab === t.id ? " on" : "");
    btn.innerHTML = `<span class="icon">${t.icon}</span>${t.label}`;
    btn.addEventListener("click", () => { currentTab = t.id; render(); });
    tabBar.appendChild(btn);
  });
}

function renderOptions() {
  optionsPanel.innerHTML = "";
  const tab = TABS.find(t => t.id === currentTab);
  if (!tab) return;

  tab.sections.forEach(sec => {
    if (sec.showIf && !sec.showIf(opts)) return;

    const div = document.createElement("div");
    div.className = "sec";

    const label = document.createElement("div");
    label.className = "sec-label";
    label.textContent = sec.label;
    div.appendChild(label);

    if (sec.type === "swatch") {
      const row = document.createElement("div");
      row.className = "swatches";

      if (sec.allowNone) {
        const none = document.createElement("div");
        none.className = "sw sw-none" + (opts[sec.key] === "None" ? " on" : "");
        none.textContent = "‚úï";
        none.title = "None";
        none.addEventListener("click", () => { opts[sec.key] = "None"; render(); });
        row.appendChild(none);
      }

      Object.entries(sec.palette).forEach(([k, v]) => {
        const sw = document.createElement("div");
        sw.className = "sw" + (opts[sec.key] === k ? " on" : "");
        sw.title = k;
        sw.style.background = sec.isFlat ? v : (v.base || v);
        sw.addEventListener("click", () => { opts[sec.key] = k; render(); });
        row.appendChild(sw);
      });

      div.appendChild(row);
    } else {
      const row = document.createElement("div");
      row.className = "textbtns";

      sec.options.forEach(o => {
        const btn = document.createElement("button");
        btn.className = "tx" + (opts[sec.key] === o ? " on" : "");
        btn.textContent = o;
        btn.addEventListener("click", () => { opts[sec.key] = o; render(); });
        row.appendChild(btn);
      });

      div.appendChild(row);
    }

    optionsPanel.appendChild(div);
  });
}

// ‚îÄ‚îÄ‚îÄ Name input ‚îÄ‚îÄ‚îÄ
nameInput.addEventListener("input", () => {
  nameplate.textContent = nameInput.value || "???";
});

// ‚îÄ‚îÄ‚îÄ Draggable divider ‚îÄ‚îÄ‚îÄ
function startDrag(e) {
  isDragging = true;
  document.body.style.cursor = "col-resize";
  document.body.style.userSelect = "none";
  e.preventDefault();
}
function onDrag(e) {
  if (!isDragging) return;
  const rect = mainArea.getBoundingClientRect();
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const pct = ((clientX - rect.left) / rect.width) * 100;
  leftPct = Math.min(70, Math.max(25, pct));
  previewPanel.style.width = leftPct + "%";
}
function endDrag() {
  isDragging = false;
  document.body.style.cursor = "";
  document.body.style.userSelect = "";
}
divider.addEventListener("mousedown", startDrag);
divider.addEventListener("touchstart", startDrag, { passive: false });
window.addEventListener("mousemove", onDrag);
window.addEventListener("touchmove", onDrag, { passive: false });
window.addEventListener("mouseup", endDrag);
window.addEventListener("touchend", endDrag);

// ‚îÄ‚îÄ‚îÄ Random ‚îÄ‚îÄ‚îÄ
function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
btnRandom.addEventListener("click", () => {
  opts = {
    skin:pick(Object.keys(SKIN)), eyes:pick(Object.keys(EYE)),
    hairStyle:pick(HAIR_STYLES), hairColor:pick(Object.keys(HAIR_COLORS)),
    shirt:pick(["None",...Object.keys(CLOTH)]), pants:pick(["None",...Object.keys(CLOTH)]),
    shoes:pick(["None",...Object.keys(CLOTH)]), armor:pick(["None",...Object.keys(METAL)]),
    headgear:pick(["None","None","Helmet","Crown","Hood"]),
    headMetal:pick(Object.keys(METAL)), hoodColor:pick(Object.keys(CLOTH)),
    weapon:pick(["None","None","Sword","Axe","Staff","Bow"]),
    shield:pick(["None","None",...Object.keys(METAL)]),
    cape:pick(["None","None","None",...Object.keys(CLOTH)]),
  };
  const names=["Shadow","Pixel","Storm","Ember","Frost","Blaze","Thorn","Sage","Rune","Hex","Jinx","Nova","Onyx","Vale","Wren","Ash","Bolt","Cinder","Drake","Echo"];
  nameInput.value = pick(names);
  render();
});

// ‚îÄ‚îÄ‚îÄ Export / Save ‚îÄ‚îÄ‚îÄ
btnSave.addEventListener("click", () => {
  const scale = 8;
  const charW = W * scale, charH = H * scale;
  const namePad = 36;
  const off = document.createElement("canvas");
  off.width = charW;
  off.height = charH + namePad;
  const oc = off.getContext("2d");
  oc.imageSmoothingEnabled = false;
  const bg = oc.createLinearGradient(0, 0, 0, off.height);
  bg.addColorStop(0, "#2a1a40"); bg.addColorStop(0.3, "#1a3050");
  bg.addColorStop(0.65, "#4a8848"); bg.addColorStop(1, "#3a6838");
  oc.fillStyle = bg;
  oc.fillRect(0, 0, off.width, off.height);
  oc.drawImage(canvas, 0, 0, W, H, 0, 0, charW, charH);
  const nm = (nameInput.value || "").trim();
  if (nm) {
    const bannerY = charH + 2;
    oc.fillStyle = "rgba(0,0,0,0.5)";
    oc.fillRect(0, bannerY, off.width, namePad - 2);
    oc.fillStyle = "#64dcc8";
    oc.font = "bold 20px 'Silkscreen', monospace";
    oc.textAlign = "center";
    oc.textBaseline = "middle";
    oc.shadowColor = "rgba(0,0,0,0.7)";
    oc.shadowBlur = 4;
    oc.fillText(nm, off.width / 2, bannerY + (namePad - 2) / 2);
    oc.shadowBlur = 0;
  }
  modalImg.src = off.toDataURL("image/png");
  modalTitle.textContent = nm || "Your Character";
  modal.style.display = "flex";
});

// ‚îÄ‚îÄ‚îÄ Modal close ‚îÄ‚îÄ‚îÄ
modalClose.addEventListener("click", () => { modal.style.display = "none"; });
modal.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ
render();
</script>
</body>
</html>
